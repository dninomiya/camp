<div class="container">
  <section class="gant">
    <h2>ユーザー一覧</h2>

    <mat-form-field>
      <mat-label>絞り込み</mat-label>
      <mat-select matInput [formControl]="filter">
        <mat-option value="">すべて</mat-option>
        <mat-option value="mentor">平日</mat-option>
        <mat-option value="mentorLite">週末</mat-option>
      </mat-select>
    </mat-form-field>

    <table
      mat-table
      [dataSource]="users$ | async"
      class="mat-elevation-z8 gant__table"
    >
      <ng-container matColumnDef="assign">
        <th mat-header-cell *matHeaderCellDef>担当</th>
        <td mat-cell *matCellDef="let element">
          <span class="user" *ngIf="element.user">
            <img [src]="element.avatarURL" class="user__avatar" alt="" />
            <span>{{ element?.name }}</span>
          </span>
        </td>
      </ng-container>

      <ng-container matColumnDef="point">
        <th mat-header-cell *matHeaderCellDef>ポイント</th>
        <td mat-cell *matCellDef="let element">
          {{ element?.point || 0 | number }}P
        </td>
      </ng-container>

      <ng-container matColumnDef="mtg">
        <th mat-header-cell *matHeaderCellDef>MTG頻度</th>
        <td mat-cell *matCellDef="let element">
          {{ element.plan | mtgType }}
        </td>
      </ng-container>

      <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
      <tr mat-row *matRowDef="let row; columns: displayedColumns"></tr>
    </table>
    <mat-progress-bar
      mode="indeterminate"
      *ngIf="tableLoading"
    ></mat-progress-bar>
  </section>

  <h2>リスト</h2>

  <div class="grid" *ngIf="products$ | async as products; else blank">
    <mat-card *ngFor="let product of products" class="product">
      <mat-card-header class="product__header">
        <div
          mat-card-avatar
          class="avatar"
          [style.background-image]="'url(' + product.author?.avatarURL + ')'"
        ></div>
        <mat-card-title class="product__title">{{
          product.title
        }}</mat-card-title>
        <mat-card-subtitle class="product__author">
          <span>{{ product.author?.name }}</span>
          <a
            class="twitter"
            [href]="product.twitter"
            *ngIf="product.twitter"
            target="_blank"
            ><i class="fab fa-twitter"></i></a
        ></mat-card-subtitle>
      </mat-card-header>
      <img
        [src]="
          product.thumbnailURL || 'https://placehold.it/800x400?text=No%20Image'
        "
        alt=""
        mat-card-image
      />
      <div class="product__description">
        <p>{{ product.description }}</p>
      </div>
      <ul *ngIf="product.links?.length">
        <li *ngFor="let link of product.links">
          <a [href]="link.url" target="_blank">{{ link.title }}</a>
        </li>
      </ul>
      <p class="product__days">
        <span *ngIf="product.start">
          {{ product.start.toDate() | date: 'yyyy年MM月dd日' }} 〜
        </span>
        <span *ngIf="product.end">
          {{ product.end.toDate() | date: 'yyyy年MM月dd日' }}
        </span>
        <span *ngIf="product.status === 'progress'">開発中</span>
      </p>
      <mat-card-actions>
        <a
          *ngIf="product.url"
          [href]="product.url"
          target="_blank"
          mat-raised-button
          color="primary"
          >サイトを見る</a
        >
        <a
          *ngIf="product.github"
          mat-button
          [href]="product.github"
          target="_blank"
          >GitHub</a
        >
      </mat-card-actions>
    </mat-card>
  </div>

  <ng-template #blank>
    <p class="blank" *ngIf="!loading">プロダクトはありません</p>
    <mat-spinner class="loading" [diameter]="40" *ngIf="loading"></mat-spinner>
  </ng-template>
</div>
